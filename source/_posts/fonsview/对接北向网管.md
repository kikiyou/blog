什么是 SNMP Trap
SNMP Trap 就是被管理设备主动发送消息给 NMS 的一种机制。

基本上是trap v2的协议


207	5.420257220	172.16.12.41	104.236.166.95	SNMP	162	snmpV2-trap SNMPv2-MIB::sysUpTime.0 SNMPv2-MIB::snmpTrapOID.0 IF-MIB::ifIndex.123 IF-MIB::ifAdminStatus.123 IF-MIB::ifOperStatus.123

https://github.com/etingof/pysnmp/blob/master/examples/hlapi/asyncore/sync/agent/ntforg/v2c-trap-with-notification-objects.py

from pysnmp.hlapi import *

errorIndication. errorStatus. errorIndex. varBinds = next(
    sendNotification(
        SnmpEngine().
        CommunityData('public').
        UdpTransportTarget(('demo.snmplabs.com'. 162)).
        ContextData().
        'trap'.
        NotificationType(
            ObjectIdentity('IF-MIB'. 'linkUp').
                           instanceIndex=(123.).
                           objects={('IF-MIB'. 'ifIndex'): 123.
                                    ('IF-MIB'. 'ifAdminStatus'): 'up'.
                                    ('IF-MIB'. 'ifOperStatus'): 'up'}
        )
    )
)

if errorIndication:
    print(errorIndication)

---------------------------------------------------

1	0.000000	111.48.19.4	211.137.58.231	SNMP	192	snmpV2-trap SNMPv2-MIB::sysUpTime.0 SNMPv2-MIB::snmpTrapOID.0 SNMPv2-SMI::enterprises.1943.2.1.1.0 SNMPv2-SMI::enterprises.1943.2.1.2.0 SNMPv2-SMI::enterprises.1943.2.1.3.0

--------------------------------------

from pysnmp.hlapi import *

mib = {ObjectIdentifier('1.3.6.1.4.1.1943.1.2.1.1'): '454545',
ObjectIdentifier('1.3.6.1.4.1.1943.1.2.1.2'): '11112',
ObjectIdentifier('1.3.6.1.4.1.1943.1.2.1.3'): '11112',
ObjectIdentifier('1.3.6.1.4.1.1943.1.2.1.4'): '11112',
ObjectIdentifier('1.3.6.1.4.1.1943.1.2.1.5'): '11112',
ObjectIdentifier('1.3.6.1.4.1.1943.1.2.1.6'): '11112',
ObjectIdentifier('1.3.6.1.4.1.1943.1.2.1.7'): '11112',
ObjectIdentifier('1.3.6.1.4.1.1943.1.2.1.8'): '11112',
ObjectIdentifier('1.3.6.1.4.1.1943.1.2.1.9'): '11112',
ObjectIdentifier('1.3.6.1.4.1.1943.1.2.1.10'): '11112'}

g = sendNotification(SnmpEngine(),
CommunityData('public'),
UdpTransportTarget(('demo.snmplabs.com', 162)),
ContextData(),
'trap',
NotificationType(ObjectIdentity(('1.3.6.1.4.1.1943.1.1.0')), objects=mib)
)

next(g)


-----------
mib = {ObjectIdentifier('1.3.6.1.2.1.2.2.1.1.123'): 123.
...        ObjectIdentifier('1.3.6.1.2.1.2.2.1.7.123'): 'testing'.
...        ObjectIdentifier('1.3.6.1.2.1.2.2.1.8.123'): 'up'}


------------------------
from pysnmp.hlapi import *

errorIndication, errorStatus, errorIndex, varBinds = next(
    sendNotification(
        SnmpEngine(),
        CommunityData('',mpModel=1),
        UdpTransportTarget(('211.137.58.231', 162)),
        ContextData(),
        'trap',
        NotificationType(
            ObjectIdentity('1.3.6.1.4.1.1943.1.1.0'),
        ).addVarBinds(
            ('1.3.6.1.4.1.1943.1.2.1.1', OctetString('999999999')),
            ('1.3.6.1.4.1.1943.1.2.1.2', OctetString('2018-08-08 08:08:08')),
            ('1.3.6.1.4.1.1943.1.2.1.3', OctetString('monkey')),
            ('1.3.6.1.4.1.1943.1.2.1.4', OctetString('monkey-type')),
            ('1.3.6.1.4.1.1943.1.2.1.5', OctetString('1.1.1.1')),
            ('1.3.6.1.4.1.1943.1.2.1.6', OctetString('monkey-id')),
            ('1.3.6.1.4.1.1943.1.2.1.7', Integer('11111')),
            ('1.3.6.1.4.1.1943.1.2.1.8', Integer('2')),
            ('1.3.6.1.4.1.1943.1.2.1.9', Integer('1')),
            ('1.3.6.1.4.1.1943.1.2.1.10', OctetString('monkey-test')),
            ('1.3.6.1.4.1.1943.1.2.1.11', OctetString('monkey-test-2')),
            ('1.3.6.1.4.1.1943.1.2.1.12', OctetString('monkey-test-3'))
        )
    )
)
if errorIndication:
    print(errorIndication)
    
# elif errorStatus:
#     print('%s at %s' % (errorStatus.prettyPrint(),
#                         errorIndex and varBinds[int(errorIndex) - 1][0] or '?'))
# else:
#     for varBind in varBinds:
#         print(' = '.join([x.prettyPrint() for x in varBind]))



------------------
from pysnmp.hlapi import *

errorIndication, errorStatus, errorIndex, varBinds = next(
    sendNotification(
        SnmpEngine(),
        CommunityData('public'),
        UdpTransportTarget(('demo.snmplabs.com', 162)),
        ContextData(),
        'inform',
        NotificationType(
            ObjectIdentity('1.3.6.1.4.1.1943.1.1.0')
        ).addVarBinds(
            ObjectType(ObjectIdentity('SNMPv2-SMI', 'enterprises.1943.1.2.1', 1), OctetString('999999999')),
            ObjectType(ObjectIdentity('SNMPv2-SMI', 'enterprises.1943.1.2.1', 2), OctetString('2018-08-08 08:08:08')),
            ObjectType(ObjectIdentity('SNMPv2-SMI', 'enterprises.1943.1.2.1', 3), OctetString('monkey')),
            ObjectType(ObjectIdentity('SNMPv2-SMI', 'enterprises.1943.1.2.1', 4), OctetString('monkey-type')),
            ObjectType(ObjectIdentity('SNMPv2-SMI', 'enterprises.1943.1.2.1', 5), OctetString('1.1.1.1')),
            ObjectType(ObjectIdentity('SNMPv2-SMI', 'enterprises.1943.1.2.1', 6), OctetString('monkey-id')),
            ObjectType(ObjectIdentity('SNMPv2-SMI', 'enterprises.1943.1.2.1', 7), Integer('11111')),
            ObjectType(ObjectIdentity('SNMPv2-SMI', 'enterprises.1943.1.2.1', 8), Integer('2')),
            ObjectType(ObjectIdentity('SNMPv2-SMI', 'enterprises.1943.1.2.1', 9), Integer('1')),
            ObjectType(ObjectIdentity('SNMPv2-SMI', 'enterprises.1943.1.2.1', 10), OctetString('monkey-test')),
            ObjectType(ObjectIdentity('SNMPv2-SMI', 'enterprises.1943.1.2.1', 11), OctetString('monkey-test-2')),
            ObjectType(ObjectIdentity('SNMPv2-SMI', 'enterprises.1943.1.2.1', 12), OctetString('monkey-test-3')),

        )
    )
)

if errorIndication:
    print(errorIndication)
elif errorStatus:
    print('%s at %s' % (errorStatus.prettyPrint(),
                        errorIndex and varBinds[int(errorIndex) - 1][0] or '?'))
else:
    for varBind in varBinds:
        print(' = '.join([x.prettyPrint() for x in varBind]))


### 展示抓包的值的方法
from pyasn1.type.univ import *
OctetString(hexValue='323031372d30332d32312032313a35363a3138')